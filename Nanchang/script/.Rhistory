library(REmap)
library(APItools)
################################
################################
####Set your APIkey here!#######
################################
################################
APIStore.init(" 1495c3e9b46f09c3c5a4f69b0e6c6e90")
function478 = APIStore(478)
get_weather_str = function(city){
content = function478(city)
if(!is.list(content)){
cat(paste("City",city,"not found!"))
output = c(NA,NA)
}else{
output = paste0("<br/>__________<br/>明天天气<br/>",
content$`HeWeather data service 3.0`[[1]]$daily_forecast[[2]]$cond$txt_d,
"<br/>",
content$`HeWeather data service 3.0`[[1]]$daily_forecast[[2]]$tmp$min,
"℃-",
content$`HeWeather data service 3.0`[[1]]$daily_forecast[[2]]$tmp$max,
"℃<br/>__________<br/>后天天气<br/>",
content$`HeWeather data service 3.0`[[1]]$daily_forecast[[3]]$cond$txt_d,
"<br/>",
content$`HeWeather data service 3.0`[[1]]$daily_forecast[[3]]$tmp$min,
"℃-",
content$`HeWeather data service 3.0`[[1]]$daily_forecast[[3]]$tmp$max,
"℃"
)
tomorrow_weather = content$`HeWeather data service 3.0`[[1]]$daily_forecast[[2]]$cond$txt_d
if(tomorrow_weather =='晴'){
png = "image://w/sunny.png"
}else if(grepl("雨",tomorrow_weather)){
png = "image://w/rainy.png"
}else{
png = "image://w/cloudy.png"
}
output = c(output,png)
}
return(output)
}
get_weather_str("上海")
cityvec = c("上海",
"广州","大连","南宁","南昌","拉萨","长春","包头",
"重庆","武汉","北京","洛阳","台北","乌鲁木齐","沈阳",
"西安","成都","合肥","长沙","济南","福州","兰州")
weather = sapply(cityvec,get_weather_str)
plotdata = data.frame(cityvec,
tooltip=paste0(cityvec,weather[1,]),
symbol = weather[2,])
remapB(markPointData = plotdata,
markPointTheme = markPointControl(symbolSize = 25,
effect = F),
color = "Blue",
title = "未来天气预报",
subtitle = "by REmap, Chiffon")
